@model CobanaEnergy.Project.Models.PostSales.StatusDashboard.StatusDashboardViewModel

@{
    ViewBag.Title = "Post-Sales Status Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Html.AntiForgeryToken()

<div class="status-dashboard">
    <div class="status-dashboard-header">
        Status Dashboard
    </div>

    <div class="filters d-flex flex-wrap gap-4 mb-4 align-items-end">
        <div>
            <label class="form-label" for="contractstatus">Contract Status</label>
            <select id="contractstatus" class="form-select"></select>
        </div>
        <div>
            <label class="form-label" for="paymentStatusAcc">Payment Status</label>
            <select id="paymentStatusAcc" class="form-select"></select>
        </div>

        <div>
            <label class="form-label" for="supplierFilter">Supplier</label>
            @Html.DropDownListFor(m => m.SupplierId, Model.Suppliers, "All Suppliers", new { @class = "form-select", id = "supplierFilter" })
        </div>

        @Html.Partial("_FiltersPartial")

    </div>

    <div class="filters d-flex flex-wrap gap-4 mb-4 align-items-end">
        <div>
            <label for="startDateFilter" class="form-label fw-semibold">Input Date From</label>
            <input type="date" id="startDateFilter" class="form-control" />
        </div>
        <div>
            <label for="endDateFilter" class="form-label fw-semibold">Input Date To</label>
            <input type="date" id="endDateFilter" class="form-control" />
        </div>
    </div>

    <div class="table-container">
        <table id="statusDashboardTable" class="table table-bordered table-striped w-100">
            <thead class="table-light">
                <tr>
                    <th>Action</th>
                    <th>Update</th>
                    <th>Send Email</th>
                    <th>Agent</th>
                    <th>Collaboration</th>
                    <th>Department</th>
                    <th>MPXN (MPAN/MPRN)</th>
                    <th>Supplier</th>
                    <th>Business Name</th>
                    <th>Input Date</th>
                    <th>Postcode</th>
                    <th>Email</th> <!-- editable -->
                    <th>Start Date</th> <!-- editable -->
                    <th>CED</th> <!-- editable -->
                    <th>CED (COT)</th> <!-- editable -->
                    <th>Contract Status</th> <!-- editable -->
                    <th>Objection Date</th> <!-- editable -->
                    <th>Objection Count</th>
                    <th>Query Type</th> <!-- editable -->
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <!-- Contract Status Counts -->
        <div class="contract-status-summary d-flex flex-wrap gap-4 mt-3">
            <div class="status-count-box">
                <span class="status-label">Contract Counter:</span>
                <span id="contractCount" class="status-count"></span>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="emailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content rounded-3 shadow">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Recipient Emails</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-striped w-100">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 70%">Email</th>
                            <th class="text-center" style="width: 30%">Action</th>
                        </tr>
                    </thead>
                    <tbody id="emailListContainer"></tbody>
                </table>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button class="btn btn-outline-secondary" id="copyAllBtn">
                    <i class="bi bi-clipboard"></i> Copy All
                </button>
                <div>
                    <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-success" id="sendEmailBtn">
                        <i class="bi bi-envelope-fill"></i> Send via Outlook
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


@section styles {
    <link href="~/Content/PostSales/statusDashboard.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" />
}

@section scripts {
    <script src="~/Scripts/Dropdown/dropdowns.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="~/Scripts/PostSales/statusDashboard.js"></script>
}

